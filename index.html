<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>

  <title>ewindisch/nova @ GitHub</title>

  <style type="text/css">
    body {
      margin-top: 1.0em;
      background-color: #58a64b;
      font-family: Helvetica, Arial, FreeSans, san-serif;
      color: #ffffff;
    }
    #container {
      margin: 0 auto;
      width: 700px;
    }
    h1 { font-size: 3.8em; color: #a759b4; margin-bottom: 3px; }
    h1 .small { font-size: 0.4em; }
    h1 a { text-decoration: none }
    h2 { font-size: 1.5em; color: #a759b4; }
    h3 { text-align: center; color: #a759b4; }
    a { color: #a759b4; }
    .description { font-size: 1.2em; margin-bottom: 30px; margin-top: 30px; font-style: italic;}
    .download { float: right; }
    pre { background: #000; color: #fff; padding: 15px;}
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    .footer { text-align:center; padding-top:30px; font-style: italic; }
  </style>
</head>

<body>
  <a href="https://github.com/ewindisch/nova"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>

  <div id="container">

    <div class="download">
      <a href="https://github.com/ewindisch/nova/zipball/master">
        <img border="0" width="90" src="https://github.com/images/modules/download/zip.png"></a>
      <a href="https://github.com/ewindisch/nova/tarball/master">
        <img border="0" width="90" src="https://github.com/images/modules/download/tar.png"></a>
    </div>

    <h1><a href="https://github.com/ewindisch/nova">nova</a>
      <span class="small">by <a href="https://github.com/ewindisch">ewindisch</a></span></h1>

    <div class="description">
      OpenStack Compute (Nova)
    </div>

    

    

    
      <h2>Install</h2>
      <p>OpenStack Nova ZeroMQ RPC Driver

Deployment guide

Abstract


With Folsom, Nova introduces an optional messaging system using ZeroMQ.  For some Nova deployments it may be desirable to use a broker-less RPC mechanism.  This document provides deployment information for this driver.

Topics are used to identify the destination for an RPC call. There are two types of topics, bare topics and directed topics.  Bare topics look like “compute” , while directed topics look like “compute.machine1”.

Enabling


To enable the driver, the ‘rpc_backend’ flag must be passed to each Nova service. The value of this flag should be ‘nova.rpc.impl_zmq’.

DNS


All TCP connections are made to hostnames. To specify, these are hostnames, not FQDNs. Host resolution is mandatory. The best practice is to deploy viable nameservers which can resolve all hostnames in the cloud under a single domain. Machines should then have dns search domain to resolve the bare hostnames.

i.e.
	dns zone for svcolo.cloudscaling.com on 192.168.1.1

	c1p509 IN A 192.168.2.1

	resolv.conf:

	search svcolo.cloudscaling.com
	nameserver 192.168.1.1
Match Making


The ZeroMQ driver implements a matching capability to discover hosts available for communication when sending to a bare topic. This allows broker-less communications.

The MatchMaker is pluggable and may also be used to enforce sending messages through a BROKER.

This driver provides four MatchMaker classes in the Essex release:
MatchMakerBroker - forces all bare topics through a broker. (DEFAULT)
MatchMakerTopicScheduler - brokers a ‘get_worker’ request, returning a hostname to create a directed topic.
MatchMakerRing - loads a static hash table from a JSON file, cycles hosts per bare topic to create a directed topic.
MatchMakerFanoutRing - loads a static hash table from a JSON file, cycles hosts per bare topic. Supports broker-less Fanout messaging. Normally, acts like MatchMakerRing, but on fanout messages returns an array of directed topics (messages are sent to all destinations).



To set the MatchMaker class, use option ‘rpc_zmq_matchmaker’.

To specify the ring file for MatchMakerRing, use option ‘rpc_zmq_matchmaker_ringfile’.

Message Broker

A MatchMaker capable of Broker-less fanout should be available by the April release.

A message broker is OPTIONAL, depending on the matchmaker chosen. Some MatchMaking services also depend on a broker, but MatchMaker modules may also reduce or eliminate the requirement for a broker. Simply, the MatchMaker allows the requirement for a broker or other discovery mechanism to be pluggable.

The IP address of this broker is set via option ‘rpc_zmq_broker_ip’.  
Message Receivers


Each machine running Nova, or sending RPC messages, must run the ‘nova-rpc-zmq-receiver’ daemon. This receives replies to call requests and routes responses via IPC to blocked callers.

Thread pool  (OPTIONAL)


Each service will launch threads for incoming requests. These threads are maintained via a pool, the maximum number of threads is limited by rpc_thread_pool_size. The default value in Nova is 1024. (This is a common RPC configuration variable, also applicable to Kombu and Qpid)
Listening Address  (OPTIONAL)


All services bind to an IP address or ethernet adapter. By default, all services bind to ‘*’, effectively binding to 0.0.0.0.  This may be changed with the option ‘rpc_zmq_bind_address’, which accepts a wildcard, IP address, or ethernet adapter.

Listening Ports (OPTIONAL)


The ZeroMQ driver may consume an unhealthy number of TCP ports. The starting port is configured with 'rpc_zmq_start_port', which defaults to 9500. Expect the driver to consume up to 50 ports, so allow and reserve ports 9500-9550 for ZeroMQ communications.


MatchMaker Ringfile  (OPTIONAL)


If deploying the MatchMakerRing, a ringfile is required as specified by the option ‘rpc_zmq_matchmaker_ringfile’.

Format


The MatchMaker ring is a JSON file containing a hash where each key is a base topic and the values are arrays.

i.e.

{
  ‘scheduler’: [ “o1p409”, “o2p409” ],
  ‘network’: [ “o3p409”, “o4p409” ]
}

Topic names


Base topics in the ring file must match the VALUES of the following nova flags:

            'compute_topic',
            'console_topic',
            'scheduler_topic',
            'volume_topic',
            'network_topic',
            'vsa_topic'

The default values of the above flags are, respectfully:

            'compute',
            'console',
            'scheduler',
            'volume',
            'network',
            'vsa'

It is NOT expected that we should need to provide an array of all compute machines unless we deploy nova-volume as it seems neither fanout cast nor a bare topic are used for ‘compute_topic’.  However, the best practice would describe all applicable hosts under the ‘compute’ and ‘volume’ topics (if applicable) within the ring-file. This would be forward-compatible with potential Nova changes and would be safest, overall.


Encryption


Since it is asked frequently, the answer is: No, the driver does NOT encrypt communications. Discussions on how and if to implement encryption are ongoing.

This driver should be deployed in a trusted environment.</p>
    

    

    
      <h2>Authors</h2>
      <p>Christopher MacGown (chris@pistoncloud.com)<br/>Duncan McGreggor (duncan@dreamhost.com)<br/>Eric Windisch (eric@cloudscaling.com)<br/>Zed Shaw (zedshaw@zedshaw.com)</p>
    

    
      <h2>Contact</h2>
      <p>Eric Windisch (eric@cloudscaling.com)<br/>      </p>
    

    <h2>Download</h2>
    <p>
      You can download this project in either
      <a href="https://github.com/ewindisch/nova/zipball/master">zip</a> or
      <a href="https://github.com/ewindisch/nova/tarball/master">tar formats.
    </p>
    <p>You can also clone the project with <a href="http://git-scm.com">Git</a>
      by running:
      <pre>$ git clone git://github.com/ewindisch/nova</pre>
    </p>

    <div class="footer">
      get the source code on GitHub : <a href="https://github.com/ewindisch/nova">ewindisch/nova</a>
    </div>

  </div>

</body>
</html>
